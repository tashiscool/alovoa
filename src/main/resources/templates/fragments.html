<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">

<body>

<div th:fragment="empty"></div>

<div th:fragment="captcha" style="margin-bottom: 4px;">
    <input id="captcha-id" name="captchaId" type="hidden">

    <div class="field" style="margin-bottom: 0px;">
        <img id="captcha-image">
    </div>
    <div class="field">
        <input class="input" id="captcha" name="captchaText" th:placeholder="#{captcha}" autocomplete="off"
               style="margin-bottom: 4px;" required>
        <button type="button" id="captcha-refresh-button" class="button is-info colored" onclick="refreshCaptcha()">
            <i class="fa fa-sync" id="captcha-refresh-icon"></i>
        </button>
    </div>
</div>

<div th:fragment="header" dir="ltr" id="header-logged-out" class="header">
    <nav class="navbar">
        <div class="navbar-brand">
            <a class="navbar-item" href="/" id="navbar-text" th:text="#{app.name}"></a>
        </div>

        <div style="width: 100%; display: flex;">
            <div class="navbar-end">
                <div class="navbar-item">
                    <a class="button is-info is-outlined" th:href="${@environment.getProperty('app.url.front-end')}" th:text="#{login}"> </a>
                </div>
            </div>
        </div>
    </nav>
</div>

<footer class="footer" th:fragment="footer" id="footer">
    <div class="container">
        <div class="columns">
            <div class="column flex-center">
                <div class="button" onclick="openModal('lang-modal')" style="margin-top: -8px;">
                    <i class="fas fa-globe" style="margin-right: 6px; margin-left: 6px;"></i>
                    <span th:text="#{language}"></span>
                </div>
            </div>
            <div class="column">
                <div class="has-text-centered">
                    <a href="/privacy" th:text="#{privacy-policy}"></a>
                </div>
            </div>
            <div class="column">
                <div class="has-text-centered">
                    <a href="/tos" th:text="#{tos}"></a>
                </div>
            </div>
            <div class="column">
                <div class="has-text-centered">
                    <a href="/imprint" th:text="#{imprint}"></a>
                </div>
            </div>
            <div class="column">
                <div class="has-text-centered">
                    <a href="/faq" th:text="#{faq}"></a>
                </div>
            </div>
            <div class="column">
                <div class="has-text-centered">
                    <a href="/donate-list" th:text="#{donate}"></a>
                </div>
            </div>
            <div class="column">
                <div class="has-text-centered">
                    <a href="https://www.github.com/Alovoa/Alovoa/">
                        <picture>
                            <source srcset="/img/github-dark.svg" media="(prefers-color-scheme: dark)">
                            <img src="/img/github.svg" style="height: 20px;">
                        </picture>
                    </a>
                    <a href="https://www.reddit.com/r/Alovoa/"><img src="/img/r-icon.svg" style="height: 20px;"
                                                                    alt="reddit"></a>
                    <a href="https://bsky.app/profile/alovoa.com"><img src="/img/bs-icon.svg" style="height: 20px;"
                                                                   alt="bluesky"></a>
                    <a href="https://mastodon.social/@alovoa_love"><img src="/img/m-icon.svg" style="height: 20px;"
                                                                        alt="mastodon"></a>
                </div>
            </div>
        </div>
    </div>

    <div id="lang-modal" class="modal modal-fx-fadeInScale">
        <div class="modal-background" onclick="closeModal()"></div>
        <div class="modal-content">
            <div style="margin: 8px;">
                <div onclick="closeModal()" style="padding-bottom: 4px;"><i class="fa fa-times fa-2x"
                                                                            style="cursor: pointer; color: white"></i>
                </div>
                <button class="button colored is-primary" value="?lang=en"
                        onclick="onChangeLocal(this.value)">English
                </button>
                <button class="button colored is-primary" value="?lang=de"
                        onclick="onChangeLocal(this.value)">Deutsch
                </button>
                <button class="button colored is-primary" value="?lang=es"
                        onclick="onChangeLocal(this.value)">Español*
                </button>
                <button class="button colored is-primary" value="?lang=fr"
                        onclick="onChangeLocal(this.value)">Français*
                </button>
                <button class="button colored is-primary" value="?lang=pt"
                        onclick="onChangeLocal(this.value)">Português*
                </button>
                <button class="button colored is-primary" value="?lang=it"
                        onclick="onChangeLocal(this.value)">Italiano*
                </button>
                <button class="button colored is-primary" value="?lang=nl"
                        onclick="onChangeLocal(this.value)">Nederlands*
                </button>
                <button class="button colored is-primary" value="?lang=cz"
                        onclick="onChangeLocal(this.value)">Čeština*
                </button>
                <button class="button colored is-primary" value="?lang=ru"
                        onclick="onChangeLocal(this.value)">русский*
                </button>
                <button class="button colored is-primary" value="?lang=ja"
                        onclick="onChangeLocal(this.value)">日本語*
                </button>
                <button class="button colored is-primary" value="?lang=zh"
                        onclick="onChangeLocal(this.value)">中文*
                </button>
                <button class="button colored is-primary" value="?lang=ko"
                        onclick="onChangeLocal(this.value)">한국어*
                </button>
                <button class="button colored is-primary" value="?lang=ar"
                        onclick="onChangeLocal(this.value)">عربى*
                </button>
                <button class="button colored is-primary" value="?lang=tr"
                        onclick="onChangeLocal(this.value)">Türkçe*
                </button>
                <button class="button colored is-primary" value="?lang=hu"
                        onclick="onChangeLocal(this.value)">Magyar*
                </button>
                <div style="color: white"><span style="float:right; margin-right: 4px;">* beta</span></div>
            </div>
        </div>
    </div>
    <script>
			function onChangeLocal(val) {
				console.log(val);
				if (val.includes('?lang=') && val.length == 8) {
					window.location.search = val;
				}
			}
    </script>
</footer>

<style>
/* Activity Badges & Tags Styles */
.user-badges .badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    font-size: 12px;
    color: white;
}
.badge-verified { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
.badge-gold { background: linear-gradient(135deg, #f59e0b, #d97706); }
.badge-silver { background: linear-gradient(135deg, #6b7280, #4b5563); }
.badge-bronze { background: linear-gradient(135deg, #92400e, #78350f); }

.activity-tag {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 4px 8px;
    border-radius: 12px;
    background: #f3f4f6;
    font-size: 0.75rem;
}
.activity-tag i { font-size: 10px; }
.tag-green { background: #dcfce7; color: #166534; }
.tag-yellow { background: #fef9c3; color: #854d0e; }
.tag-red { background: #fee2e2; color: #991b1b; }

@media (prefers-color-scheme: dark) {
    .activity-tag { background: #374151; color: #d1d5db; }
    .tag-green { background: #14532d; color: #86efac; }
    .tag-yellow { background: #713f12; color: #fde047; }
    .tag-red { background: #7f1d1d; color: #fca5a5; }
}

.card-image { position: relative; }
</style>

<div th:fragment="search-users" class="user-search-div">

    <div th:if="${#lists.isEmpty(dto.users)}"
         style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; padding-top: 12px;">
        <span th:text="#{no-users-found}"></span>
    </div>

    <div th:if="${dto.message != null}" id="search-message" th:text="${dto.message}" style="display: none;"></div>

    <th:block th:each="user : ${dto.users}">
        <div class="user-search-card" th:id="${user.uuid}">
            <div class="card-image" th:onclick="viewProfile([[${user.uuid}]])">
                <figure class="image">
                    <img th:src="${user.profilePicture}" class="profile-pic">
                </figure>
                <!-- Activity & Trust Badges -->
                <div class="user-badges" style="position: absolute; top: 8px; left: 8px; display: flex; flex-wrap: wrap; gap: 4px;">
                    <!-- Video Verified Badge -->
                    <span th:if="${user.videoVerified}" class="badge badge-verified" title="Video Verified">
                        <i class="fas fa-video"></i>
                    </span>
                    <!-- Trust Level Badge -->
                    <span th:if="${user.trustLevel != null and user.trustLevel != 'NEW_MEMBER'}"
                          class="badge"
                          th:classappend="${user.trustLevel == 'EXEMPLARY'} ? 'badge-gold' : (${user.trustLevel == 'VERIFIED_TRUSTED'} ? 'badge-silver' : 'badge-bronze')"
                          th:title="${user.trustLevel}">
                        <i class="fas fa-shield-alt"></i>
                    </span>
                </div>
            </div>
            <div style="padding: 16px; display: flex; flex-direction: column;">
                <div style="font-size: 1.2em; padding-bottom: 8px;" class="description"
                     th:text="${user.description}"></div>

                <!-- Activity Indicators -->
                <div class="user-activity-row" style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; font-size: 0.8em; color: #666;">
                    <!-- Response Rate -->
                    <span th:if="${user.responseRate != null}" class="activity-tag"
                          th:classappend="${user.responseRate == 'REPLIES_OFTEN'} ? 'tag-green' : (${user.responseRate == 'REPLIES_SELECTIVELY'} ? 'tag-yellow' : 'tag-red')">
                        <i class="fas fa-reply"></i>
                        <span th:switch="${user.responseRate}">
                            <span th:case="'REPLIES_OFTEN'" th:text="#{profile.replies.often}">Replies often</span>
                            <span th:case="'REPLIES_SELECTIVELY'" th:text="#{profile.replies.selectively}">Replies selectively</span>
                            <span th:case="'REPLIES_VERY_SELECTIVELY'" th:text="#{profile.replies.verySelectively}">Very selective</span>
                        </span>
                    </span>
                    <!-- Active Conversations -->
                    <span th:if="${user.activeConversationCount > 0}" class="activity-tag">
                        <i class="fas fa-comments"></i>
                        <span th:text="${user.activeConversationCount}">0</span> active
                    </span>
                    <!-- Feedback Score -->
                    <span th:if="${user.positiveFeedbackCount > 0 or user.negativeFeedbackCount > 0}" class="activity-tag"
                          th:classappend="${user.positiveFeedbackCount > user.negativeFeedbackCount} ? 'tag-green' : (${user.negativeFeedbackCount > user.positiveFeedbackCount} ? 'tag-red' : '')">
                        <i class="fas fa-thumbs-up"></i> <span th:text="${user.positiveFeedbackCount}">0</span>
                        <i class="fas fa-thumbs-down" style="margin-left: 4px;"></i> <span th:text="${user.negativeFeedbackCount}">0</span>
                    </span>
                    <!-- Reputation Score -->
                    <span th:if="${user.reputationScore != null and user.reputationScore >= 50}" class="activity-tag"
                          th:classappend="${user.reputationScore >= 80} ? 'tag-green' : (${user.reputationScore >= 60} ? 'tag-yellow' : '')">
                        <i class="fas fa-star"></i>
                        <span th:text="${#numbers.formatDecimal(user.reputationScore, 0, 0)}">75</span>
                    </span>
                </div>

                <button class="button" th:onclick="viewProfileMedia([[${user.uuid}]])"><i
                        class="fa fa-photo-video"></i></button>
            </div>
        </div>
    </th:block>
</div>

<!-- Reusable Verification Badge Fragment -->
<div th:fragment="verification-badges(user)" class="aura-badge-group">
    <!-- Video Verification Badge -->
    <span th:if="${user.videoVerified}" class="aura-verification-badge" title="Video Verified">
        <i class="fas fa-check-circle"></i>
        <span>Verified</span>
    </span>

    <!-- Trust Level Badge -->
    <span th:if="${user.trustLevel != null}"
          class="aura-trust-badge"
          th:classappend="${#strings.toLowerCase(user.trustLevel).replace('_', '-')}"
          th:title="${user.trustLevel}">
        <i class="fas fa-shield-alt"></i>
        <span th:switch="${user.trustLevel}">
            <span th:case="'NEW_MEMBER'">New Member</span>
            <span th:case="'VERIFIED'">Verified</span>
            <span th:case="'TRUSTED'">Trusted</span>
            <span th:case="'HIGHLY_TRUSTED'">Highly Trusted</span>
            <span th:case="'UNDER_REVIEW'">Under Review</span>
            <span th:case="'RESTRICTED'">Restricted</span>
        </span>
    </span>
</div>

<!-- Compact Verification Icons Fragment (for small spaces like search cards) -->
<div th:fragment="verification-icons(user)" class="aura-badge-inline">
    <!-- Video Verified Icon -->
    <span th:if="${user.videoVerified}" class="aura-verification-badge" title="Video Verified" style="padding: 0.2rem 0.5rem;">
        <i class="fas fa-video"></i>
    </span>

    <!-- Trust Level Icon -->
    <span th:if="${user.trustLevel != null and user.trustLevel != 'NEW_MEMBER'}"
          class="aura-trust-badge"
          th:classappend="${#strings.toLowerCase(user.trustLevel).replace('_', '-')}"
          th:title="${user.trustLevel}"
          style="padding: 0.2rem 0.5rem;">
        <i class="fas fa-shield-alt"></i>
    </span>
</div>

<!-- Detailed Reputation Card Fragment (for profile pages) -->
<div th:fragment="reputation-card(user)" class="aura-card" style="margin-top: 1rem;">
    <div class="aura-card-header">
        <div class="aura-card-icon"><i class="fas fa-star"></i></div>
        <div>
            <div class="aura-card-title">Reputation & Trust</div>
            <div class="aura-card-subtitle">How this user is viewed in the community</div>
        </div>
    </div>

    <!-- Trust Level Display -->
    <div style="margin-bottom: 1.5rem; padding: 1rem; background: var(--aura-gradient-subtle); border-radius: 0.75rem;">
        <div style="display: flex; align-items: center; gap: 0.75rem;">
            <span th:switch="${user.trustLevel}" style="font-size: 2rem;">
                <i th:case="'HIGHLY_TRUSTED'" class="fas fa-shield-alt" style="color: var(--aura-success);"></i>
                <i th:case="'TRUSTED'" class="fas fa-check-circle" style="color: var(--aura-success);"></i>
                <i th:case="'VERIFIED'" class="fas fa-user-check" style="color: var(--aura-info);"></i>
                <i th:case="'NEW_MEMBER'" class="fas fa-user" style="color: var(--aura-gray-500);"></i>
                <i th:case="'UNDER_REVIEW'" class="fas fa-clock" style="color: var(--aura-warning);"></i>
                <i th:case="'RESTRICTED'" class="fas fa-exclamation-triangle" style="color: var(--aura-danger);"></i>
            </span>
            <div style="flex: 1;">
                <div style="font-weight: 600; font-size: 1.125rem;" th:switch="${user.trustLevel}">
                    <span th:case="'NEW_MEMBER'">New Member</span>
                    <span th:case="'VERIFIED'">Verified Member</span>
                    <span th:case="'TRUSTED'">Trusted Member</span>
                    <span th:case="'HIGHLY_TRUSTED'">Highly Trusted</span>
                    <span th:case="'UNDER_REVIEW'">Under Review</span>
                    <span th:case="'RESTRICTED'">Restricted</span>
                </div>
                <div style="font-size: 0.875rem; color: var(--aura-gray-600); margin-top: 0.25rem;" th:switch="${user.trustLevel}">
                    <span th:case="'NEW_MEMBER'">New to AURA - building their reputation</span>
                    <span th:case="'VERIFIED'">Verified member with basic verification</span>
                    <span th:case="'TRUSTED'">Trusted member with positive history</span>
                    <span th:case="'HIGHLY_TRUSTED'">Exemplary member with excellent track record</span>
                    <span th:case="'UNDER_REVIEW'">Account under review</span>
                    <span th:case="'RESTRICTED'">Limited features due to policy violations</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Reputation Stats -->
    <div class="aura-stats aura-stagger" style="margin-bottom: 1rem;">
        <div class="aura-stat">
            <div class="aura-stat-value" th:text="${user.reputationScore != null ? #numbers.formatDecimal(user.reputationScore, 0, 0) : '50'}">75</div>
            <div class="aura-stat-label"><i class="fas fa-star mr-1"></i> Overall</div>
        </div>
        <div class="aura-stat" th:if="${user.positiveFeedbackCount != null}">
            <div class="aura-stat-value" th:text="${user.positiveFeedbackCount}">5</div>
            <div class="aura-stat-label"><i class="fas fa-thumbs-up mr-1"></i> Positive</div>
        </div>
        <div class="aura-stat" th:if="${user.videoVerified != null}">
            <div class="aura-stat-value">
                <i th:if="${user.videoVerified}" class="fas fa-check" style="color: var(--aura-success);"></i>
                <i th:unless="${user.videoVerified}" class="fas fa-times" style="color: var(--aura-gray-400);"></i>
            </div>
            <div class="aura-stat-label"><i class="fas fa-video mr-1"></i> Verified</div>
        </div>
    </div>

    <!-- Additional Info -->
    <div th:if="${user.responseRate != null}" style="margin-top: 1rem; padding: 0.75rem; background: var(--aura-bg-secondary); border-radius: 0.5rem;">
        <div style="font-size: 0.875rem; color: var(--aura-gray-600);">
            <i class="fas fa-comment mr-2"></i>
            <span th:switch="${user.responseRate}">
                <span th:case="'REPLIES_OFTEN'">Replies often to messages</span>
                <span th:case="'REPLIES_SELECTIVELY'">Replies selectively</span>
                <span th:case="'REPLIES_RARELY'">Rarely replies</span>
                <span th:case="*">Response rate not available</span>
            </span>
        </div>
    </div>

    <!-- Warning for Under Review or Restricted -->
    <div th:if="${user.trustLevel == 'UNDER_REVIEW' or user.trustLevel == 'RESTRICTED'}"
         class="aura-alert aura-alert-warning" style="margin-top: 1rem;">
        <i class="fas fa-exclamation-triangle fa-lg"></i>
        <div>
            <strong>Please exercise caution</strong>
            <p style="margin-top: 0.25rem;">This account has been flagged for review. Proceed with care when interacting with this user.</p>
        </div>
    </div>
</div>

<!-- Donation Modal Fragment -->
<div th:fragment="donation-modal" th:replace="~{fragments/donation-modal.html::donation-modal}"></div>

</body>

</html>